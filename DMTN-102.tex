\documentclass[DM,lsstdraft,authoryear,toc]{lsstdoc}
% lsstdoc documentation: https://lsst-texmf.lsst.io/lsstdoc.html

% Package imports go here.
\usepackage{graphicx}
\usepackage{url}
\usepackage{latexsym}
\usepackage{color}
\usepackage{enumitem}

% Local commands go here.

% To add a short-form title:
% \title[Short title]{Title}
\title[Alerts Key Numbers]{LSST Alerts: Key Numbers}

% Optional subtitle
% \setDocSubtitle{A subtitle}

\author{%
M.~L.~Graham, E.~Bellm, L.~Guy, C.~T.~Slater, G.~Dubois-Felsmann, and the Data Management Subsystem Science Team
}

\setDocRef{DMTN-102}

\date{\today}

% Optional: name of the document's curator
% \setDocCurator{The Curator of this Document}
\setDocUpstreamLocation{\url{https://github.com/lsst-dm/dmtn-102}}

\setDocAbstract{%
A quantitative review of the key numbers associated with the LSST Alert Stream.
}

% Change history defined here.
% Order: oldest first.
% Fields: VERSION, DATE, DESCRIPTION, OWNER NAME.
% See LPM-51 for version number policy.
\setDocChangeRecord{%
  \addtohist{1}{2018-12-06}{Unreleased.}{Melissa Graham}
}

\begin{document}

% Create the title page.
% Table of contents is added automatically with the "toc" class option.
\maketitle

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\section{Introduction} \label{sec:intro}

The LSST Data Management System's (DMS) Alert Production (AP) pipeline will process new data as it is obtained by the telescope. Difference Imaging Analysis (DIA) will be performed, and all sources with a signal-to-noise ratio\reqparam{transSNR}\lsrreq{0101}\dmreq{0269}\dmreq{0274} $>$5 (in positive or negative flux) will be considered "detected", instantiate a record in the source catalogs, and generate an alert. Each alert is a packet containing LSST data about the source such as coordinates, photometry, and image cutouts. For a full description of detected sources and alert packet contents, see \citeds{LSE-163}. The LSST alert stream will be delivered to several community-developed brokers, and also accessible to users\footnote{In this case, "users" is restricted to individuals with LSST data rights and access privileges.} via an alert filtering service through the LSST Data Access Centers (DACs). Plans and policies for alert distribution are provided in \citeds{LDM-612}. 

The purpose of this document is to quantitatively inform broker developers, and the broader scientific community planning to use alerts, on the key numbers regarding alert generation, distribution, and access via the LSST alert filtering service. The goals of this document are threefold: (1) to provide all of the key numbers regarding alert generation in one place; (2) to include any and all basis information, assumptions, and derivations that contributed to the key number; and (3) to be clear about whether each key number represents an estimate, a requirement, or a boundary. Wherever possible, the reference to a specific LSST requirement and any relevant requirement parameters are provided in the left-hand column. In this document we use 8 bits per byte (B), and 1024~B per KB, 1024~KB per MB, and so forth.

% The resources used in the preparation of this document are as follows:
% \begin{itemize}
% \item {\it LSST: From Science Drivers to Reference Design and Anticipated Data Products}, \citet{2008arXiv0805.2366I}
% \item LSST Science Requirements Document (SRD), \citeds{LPM-17}.
% \item LSST System Requirements (LSR), \citeds{LSE-29}.
% \item Observatory System Specifications (OSS) document, \citeds{LSE-30}.
% \item Data Management System Requirements (DMSR) document, \citeds{LSE-61}.
% \item Science Requirements and System Specifications Spreadsheet (SR\&SSS), \citeds{LSE-81}.
% \item Data Products Definitions Document (DPDD), \citeds{LSE-163}
% \item Plans and Policies for LSST Alert Distribution, \citeds{LDM-612}
% \item Data Management Science Pipelines Design, \citeds{LDM-151}
% \end{itemize}


% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\section{Alert Stream} \label{sec:alerts}

The concept and existence of the LSST alert stream was first introduced by the highest-level document, the LSST Science Requirements Document \citedsp{LPM-17}, which specifies that information about the detections of transient, variable, and moving objects be released promptly as a data stream. 


% % % % % % % % % % % % %
\subsection{Alert Release Timescale}\label{ssec:OTT1}

{\bf It is a formal requirement that the DMS make available 98\%\reqparam{OTT1}\reqparam{OTR1}\lsrreq{0101}\lsrreq{0025}\ossreq{0127}\dmreq{0004} of alerts for each visit within 60 seconds of the end of image readout\footnote{The design, minimum, and stretch values for the alert release timescale are 1, 2, and 0.5 minutes \citedsp{LPM-17}.}.}

The term "make available" refers to the point at which an LSST alert packet becomes available for broker retrieval (i.e., it does not include the time it takes for a broker to receive or ingest the alert). It is furthermore specified that all delayed alerts be made available at the next opportunity (\citeds{LPM-17}; see also the discussion regarding delayed/failed alert distribution in \S~\ref{ssec:OTR1}).


% % % % % % % % % % % % %
\subsection{Number of Alerts per Visit (and per Night)}\label{ssec:transN}

{\bf It is a formal requirement that the DMS support the generation of \reqparam{transN}\lsrreq{0101}\reqparam{nAlertVisitAvg}\ossreq{0193} at least 10,000 alerts per visit\footnote{The design, minimum, and stretch values for the number of alerts per visit are $10^4$, $10^3$, and $10^5$ \citedsp{LPM-17}.} on average, and an instantaneous maximum of 40,000 alerts per visit.}

An approximate upper limit on the number of standard visits (the equivalent of 30 seconds of exposure time, plus $\sim$4 seconds of overhead) per night is 1,000 visits, which corresponds to $\lesssim$9.5 hours of observing time. Pending updates to LSST documentation (\citeds{LSE-30} and \citeds{LSE-61}) will clarify that the DMS must support a long-term average number of alerts {\it per night} of $10^7$ (i.e., 10,000 alerts per visit for 1,000 standard visits per night) and instantaneous peaks of 40,000 alerts {\it per visit}. At the time of writing, the latter was only defined in the DM sizing model \citedsp{LSE-81}.

The value of 10,000 alerts per visit is a formal requirement on the DMS and not a scientific estimate of the intrinsic rate of transients and variables in the universe. However, estimates for the most common transients and variables can be derived from the Science Book \citep{2009arXiv0912.0201L} by making some significant assumptions, as follows:
\begin{itemize}
\item Variable Stars: LSST is predicted to observe a total of $\sim$135 million variable stars. Making the simple assumption that 20\% (80\%) of the stars are in extragalactic (Galactic) fields, and that of the $\sim$18,000 deg$^2$ surveyed by LSST, 80\% (20\%) of the fields are extragalactic (Galactic), and that 10\% of all variable stars are detectably variable at any given time, then a typical extragalactic (Galactic) field would yield $\sim$1,800 ($\sim$28,800) alerts per visit. Averaged over all fields, and weighted by 80\% and 20\% of the fields being extragalactic and Galactic, respectively, this is an average of 7,200 alerts per visit.
\item Supernovae: LSST is predicted to observe a total of $\sim$10 million supernovae in 10 years, or $\sim$1 million per year. Since SNe are typically only visible for a few months, there might be $\sim$0.3 million detectable at any given time. Over 15,000 deg$^{2}$ of extragalactic survey area, that's $\sim$20 SNe deg$^{-2}$ or $\sim$200 alerts for SNe per visit.
\item Active Galactic Nuclei: LSST is predicted to observe millions of AGN. If $\sim$10\% of them are detectably variable at any given time, then the estimate is that $\sim$0.1 million alerts over 15,000 deg$^2$ would generate $\sim$7 alerts deg$^{-2}$, or $\sim$70 alerts per visit for AGN.
\item Moving Objects: The number of Solar System objects that LSST is predicted to observe is dominated by the 5.5 million main-belt asteroids. Assuming that they are spread evenly over the $\sim$18,000 deg$^2$ survey area (even though they're not, as they're found primarily along the ecliptic) leads to $\sim$3,000 alerts per visit due to moving objects.
\end{itemize} 
Therefore, astrophysical estimates for the occurrence rates of alerts caused by the most common types of transients and variables yield $\sim$5,100 ($\sim$32,000) alerts per visit in extragalactic (Galactic) fields, with an average of $\sim$10,500 alerts per visit.


% % % % % % % % % % % % %
\subsection{Alert Packet Size}\label{ssec:packet_size}

{\bf The size of an individual alert packet is estimated to be $\lesssim$82~KB.}

There are no formal requirements regarding the alert packet size. The statement above is an estimate based on the planned content of the alerts as described in Section 3.5 of \citeds{LSE-163}. Simulated alert packets based on the Apache Avro format are at most $\sim$82~KB. This volume represents an alert packet for a variable star with a full 12 month history of detections. The application of gzip compression can further reduce the size of an alert to $\sim$65~KB (JIRA ticket DM-16280). Cutout stamps included in the alert will be at least 30$\times$30 pixels and contain flux (32 bit/pix), variance (32 bit/pix), and mask (16 bit/pix) extensions for both the template and difference image, plus a header of metadata \citedsp{LSE-163}. The stamps alone will contribute $\gtrsim$18~KB to the total size of the uncompressed alert packet (i.e., $\sim$20\%).

{\bf "Lite" Packet Options --} Brokers which plan to do their own source association, compile source catalogs based on alerts, or not use the image stamps might prefer a stream of packets with appropriately reduced information. The LSST DM team currently expects that providing a subset of alert packet contents will be feasible, and brokers may indicate which information they require during the broker proposal process  \citedsp{LDM-612}. As previously mentioned, removing the image stamps would reduce packet size by $\gtrsim$18~KB. Removing the historical records of past detections would also reduce the size of all alert packets. A few of these options might also be available to users of the LSST alert filtering service (\S~\ref{sec:LAFS}). 


% % % % % % % % % % % % %
\subsection{Alert Stream Data Rate}\label{ssec:data_rate}

{\bf The time-averaged data rate of the alert stream is estimated to be $\sim$25~MB~s$^{-1}$, potentially with bursts of up to 640~MB~s$^{-1}$.}

There are no formal requirements regarding the alert stream data rate. The values quoted in the statement above are estimates based on the expected size of an alert packet ($\sim$82~KB, Section \ref{ssec:packet_size}), the number of alerts per visit, and the alert distribution mechanism. Using an average of 10,000 alerts released per standard visit, this leads to a {\it time-averaged} alert stream data rate of  $\sim$25~MB~s$^{-1}$. As discussed in \S~\ref{ssec:transN}, the number of alerts per field will vary in extragalactic and Galactic fields from $\sim$2,000 to $\lesssim$40,000, which would produce {\it time-averaged} alert streams of $\sim$5 to $\lesssim$100~MB~s$^{-1}$. However, in order to release alerts within 60 seconds of image readout (\S~\ref{ssec:OTT1}), the stream will not be continuous in time, but periodic, with potential bursts: if all 10,000 alerts are issued within the last 5 seconds of that window the data rate would be 160~MB~s$^{-1}$. In galactic fields with $\sim$40,000 alerts per visit this could be as high as 640~MB~s$^{-1}$.


% % % % % % % % % % % % %
\subsection{Number of Selected Brokers}\label{ssec:num_brokers}

{\bf The DM team estimates that resources will allow for the delivery of the alert stream to 4 to 7 community brokers.}

There are no formal requirements on the number of brokers. The statement above is an estimate based on the alert stream data rate and the bandwidth allocated to alert distribution. As described in Section 2.2.3 of \citeds{LDM-612}: {\it "An allocation of 10~Gbps is baselined for alert stream transfer from the [LSST Data Facility], with an estimated packet size of 82~KB and up to 10,000 alerts per visit. For illustration, based on these numbers up to 7 brokers could receive the full stream if 5 seconds is budgeted for outbound data transfer."} 


% % % % % % % % % % % % %
\subsection{Alert Database Volume}\label{ssec:adb_volume}

{\bf The estimated maximum upper limit for the full, 10-year alerts database is $\lesssim$3~PB.}

There are no formal requirements on the alerts database volume. The statement above is an estimate based on the alert packet contents and the number of alerts per night. As described in \S~\ref{ssec:transN}, the DMS system will support an average of $\sim$10 million alerts per night (which approximately matches the expected scientific yields). Assuming the upper estimate of $\sim$82~KB per alert (\S~\ref{ssec:packet_size}), that leads to a total of $\sim$782~GB per night. An extreme upper limit is 365 nights per year for 10 years, which would amount to $\sim$2.7~PB {\it at the very most}. Therefore we quote an extreme upper limit on the alerts database as $\lesssim$3~PB. Compression could drastically lower this, as could reformatting: every alert contains a $\sim$12 month historical record and links to the most recent DIAObject and DR Object catalogs. The set of alerts for the same transient/variable would contain a significant amount of redundant information, which is provided to enable rapid filtering but could be reformatted for long-term storage (i.e., removed from the individual alerts and compiled elsewhere in an alerts database). 


% % % % % % % % % % % % %
\subsection{Delayed/Failed Alert Distribution}\label{ssec:OTR1}

{\bf It is a formal requirement that no more than 1\% (0.1\%)\reqparam{sciVisitAlertDelay}\reqparam{sciVisitAlertFailure}\ossreq{0112} of all science visits experience delayed (failed) alert generation and distribution.}

Given the requirement in \S~\ref{ssec:OTT1} that 98\% of all alerts be made available within 60 seconds, a visit would be considered "delayed" and count towards that 1\% limit if, and only if, $>$2\% of its alerts were made available with a latency of $>$60 seconds. The requirement that no more than 0.1\% of all science visits fail to generate and/or distribute alerts is integrated over all stages of data handling (i.e., includes failures at any stage of prompt processing).

Assuming $\sim$10 million alerts per night (\S~\ref{ssec:transN}), brokers can rely on the DMS to not exceed an upper limit of 200,000 alerts (2\%) being made available with a latency of $>$60 seconds, and an upper limit of 10,000 alerts (or 1 visit's worth, i.e., 0.1\% of 1,000 visits per night) that fail to be generated and/or made available.


% % % % % % % % % % % % %
\subsection{Alert Stream Completeness and Purity}\label{ssec:comp_pure}

{\bf It is a formal requirement that DM derive and supply threshold values\reqparam{transSampleSNR}\reqparam{transCompletenessMin}\reqparam{transPurityMin}\ossreq{0353} for a spuriousness\footnote{In this context, spuriousness is like a real/bogus score.} parameter which can be used to filter alerts into a subsample of transient and variable objects with a given completeness and purity.}

The formal requirement is that DM calculate a spuriousness parameter for all alerts, and derive and supply a spuriousness threshold value that filters the full stream into a subsample of alerts for transient and variable objects\footnote{See also OSS-REQ-0354 for the required parameters for a subsample of moving objects \citedsp{LSE-30}.} which is 90\% complete and 95\% pure for all sources with a signal-to-noise ratio $>$6. While the requirements on purity and completeness are specified as point thresholds, DM expects to provide information to enable users to choose spuriousness threshold values which will filter the stream to a desired level of completeness and purity, thereby reducing the fraction of false positives (sources detected that are not astrophysical in origin) to a level that is appropriate for their science goals. Brokers could request a pre-filtered stream that includes a restriction on spuriousness.


% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\section{The LSST Alert Filtering Service} \label{sec:LAFS}

{\bf It is a formal requirement that the LSST provide an alerts filtering service for users.}\dmreq{0342}\dmreq{0348} 

The LSST alerts filtering service is a mechanism by which users --- individuals with LSST data rights and access --- can receive alerts via pre-defined filters that have been optimized for established transient classifications such as supernovae and/or create and apply their own filters to the stream \citedsp{LPM-17,LSE-61}. 


% % % % % % % % % % % % %
\subsection{Number of Simultaneous Users}\label{ssec:LAFS_users}

{\bf It is a formal requirement that the LSST alert filtering service be able to support\reqparam{numBrokerUsers}\dmreq{0343} at least 100 simultaneous users.}

This requirement is driven by outbound bandwidth limitations from the Data Access Center at the National Center for Supercomputing Applications, and the DM team is currently investigating approaches that would support larger numbers of active users \citedsp{LDM-612}. During LSST Operations, if the total number of simultaneous users is oversubscribed then a proposal process may be instituted \citedsp{LSE-163}.


% % % % % % % % % % % % %
\subsection{Number of Alerts per Visit Returned}\label{ssec:LAFS_returns}

{\bf It is a formal requirement that the LSST alert filtering service be able to return 20\reqparam{numBrokerAlerts}\dmreq{0343} full-sized alerts per visit per user.}

Assuming 1,000 visits per night (\S~\ref{ssec:transN}), each user's filter will be capable of returning 20,000 alerts per night, which would amount to $\sim$1.6~GB (\S~\ref{ssec:packet_size}).


% % % % % % % % % % % % %
\subsection{Alerts Archive}\label{ssec:LAFS_adb}

{\bf It is a formal requirement that all alerts be stored in an archival database and be available for retrieval.}\ossreq{0185}

The term "available for retrieval" applies to users with data rights and access to the LSST Science Platform. Like all other Prompt data products, the alerts archive will be updated within 24\reqparam{L1PublicT}\lsrreq{0104} hours \citedsp{LSE-29}. The alerts archive is not a part of the LSST alert filtering service, but is included in this section to raise awareness of its existence. 

The LSST DM team anticipates that the alerts archive will support queries by their unique alert identification numbers, but might not support searches by coordinate, time, magnitude, or other alert attributes. For this reason, the alerts archive should {\em not} be considered a viable alternative for users who {\em do} wish to study transient, variable and moving objects with the LSST, but who {\em do not} require immediate (i.e., same-night) access to sources detected via difference image analysis. In other words, queries to the alerts archival database should not be construed as a viable alternative to community brokers or the LSST alert filtering service. Instead, users with science goals that are achievable with a latency of $\geq$24 hours should plan to use the Prompt data products described in Section 3 of \citeds{LSE-163}. Furthermore, users with science goals that are achievable with latencies of a year or more (i.e., archival time-domain studies) should plan to use the Data Release data products described in Section 4 of \citeds{LSE-163}.


% Include all the relevant bib files.
% https://lsst-texmf.lsst.io/lsstdoc.html#bibliographies
\bibliography{local,lsst,lsst-dm,refs_ads,refs,books}

\end{document}
