

\documentclass[DM,authoryear,toc]{lsstdoc}
% lsstdoc documentation: https://lsst-texmf.lsst.io/lsstdoc.html

% Package imports go here.
\usepackage{graphicx}
\usepackage{url}
\usepackage{latexsym}
\usepackage{color}
\usepackage{enumitem}

% Local commands go here.

% To add a short-form title:
% \title[Short title]{Title}
\title[Alerts Key Numbers]{LSST Alerts: Key Numbers}

% Optional subtitle
% \setDocSubtitle{A subtitle}

\author{%
M.~L.~Graham, E.~Bellm, L.~Guy, C.~T.~Slater, et al.
}

\setDocRef{DMTN-102}

\date{\today}

% Optional: name of the document's curator
% \setDocCurator{The Curator of this Document}
\setDocUpstreamLocation{\url{https://github.com/lsst-dm/dmtn-102}}

\setDocAbstract{%
A quantitative review of the key numbers associated with the LSST Alert Stream.
}

% Change history defined here.
% Order: oldest first.
% Fields: VERSION, DATE, DESCRIPTION, OWNER NAME.
% See LPM-51 for version number policy.
\setDocChangeRecord{%
  \addtohist{1}{2018-12-06}{Unreleased.}{Melissa Graham}
}

\begin{document}

% Create the title page.
% Table of contents is added automatically with the "toc" class option.
\maketitle

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\section{Introduction} \label{sec:intro}

The LSST Data Management System's (DMS) Alert Production (AP) pipeline will process new data as it is obtained by the telescope. Difference Imaging Analysis (DIA) will be performed, and all sources with a signal-to-noise ratio {\tt transSNR} $>5$ in positive or negative flux will be considered "detected", instantiate a record in the source catalogs, and generate an alert (LSR-REQ-0101 \citeds{LSE-29}; DMS-REQ-0269, -0274 \citeds{LSE-61}). Each alert is a packet containing LSST data about the source such as coordinates, photometry, and image cutouts. For a full description of detected sources and alert packet contents, see \citeds{LSE-163}. The LSST alert stream will be delivered to several community-developed brokers, and also accessible to users via the LSST Science Platform's Alert Filtering Service (LAFS). Plans and policies for alert distribution are provided in \citeds{LDM-612}. 

The purpose of this document is to quantitatively inform broker developers, and the broader scientific community planning to use alerts, on the key numbers regarding alert generation, distribution, and access via the LSST alert filtering service. The goals of this document are threefold: (1) to provide all of the key numbers regarding alert generation in one place; (2) to include any and all basis information, assumptions, and derivations that contributed to the key number; and (3) to be clear about whether each key number represents an estimate, a requirement, or a boundary. In this work we use 8 bits per byte ($\rm B$), and $1024$ $\rm B$ per $\rm KB$, $1024$ $\rm KB$ per $\rm MB$, and so forth.

The resources used in the preparation of this document are as follows:
\begin{itemize}
\item {\it LSST: From Science Drivers to Reference Design and Anticipated Data Products}, \citet{2008arXiv0805.2366I}
\item LSST Science Requirements Document (SRD), \citeds{LPM-17}.
\item LSST System Requirements (LSR), \citeds{LSE-29}.
\item Observatory System Specifications (OSS) document, \citeds{LSE-30}.
\item Data Management System Requirements (DMSR) document, \citeds{LSE-61}.
\item Science Requirements and System Specifications Spreadsheet (SR\&SSS), \citeds{LSE-81}.
\item Data Products Definitions Document (DPDD), \citeds{LSE-163}
\item Plans and Policies for LSST Alert Distribution, \citeds{LDM-612}
\item Data Management Science Pipelines Design, \citeds{LDM-151}
\end{itemize}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\section{Alert Stream} \label{sec:alerts}

The concept and existence of the LSST alert stream was first introduced by the highest-level document, the LSST Science Requirements Document (SRD), which specifies that information about the detections of transient, variable, and moving objects be released promptly as a data stream. 

% % % % % % % % % % % % %
\subsection{Alert Release Timescale}\label{ssec:OTT1}

{\bf It is a formal requirement that the DMS make available $98\%$ of alerts for each visit within $60$ seconds of the end of image readout.}

Regarding the DMS's ability to generate alerts, the SRD states that {\it "data on likely optical transients ... will be released with a latency of at most {\tt OTT1} minutes"}, where the design, minimum, and stretch values for {\tt OTT1} are $1$, $2$, and $0.5$ minutes, respectively \citedsp{LPM-17}. The SRD's requirement flows down to the LSR, which also defines the fraction of alerts per visit that must be made available within {\tt OTT1} as {\tt OTR1}$=98\%$ (LSR-REQ-0101,-0025 \citeds{LSE-29}). The LSR's requirements on {\tt OTT1} and {\tt OTR1} flow down to the OSS (OSS-REQ-0127, \citeds{LSE-30}) and the DMSR (DMS-REQ-0004, \citeds{LSE-61}). It is the intent of these requirements that {\tt OTT1} covers only the time that the DMS has control over: from the end of camera readout to the time the alert packet "crosses the border" of NCSA and becomes publicly available for the brokers (i.e., {\tt OTT1} does not include the time it takes for a broker to receive or ingest the alert). It is sometimes colloquially said that {\tt OTT1} starts {\it at the time of shutter close}, but it actually starts {\it at the end of readout} (i.e., $2$ seconds later, or longer if slower reads are adopted). The LSR also specifies that all delayed alerts be made available at the next opportunity (see also the discussion regarding formal requirements on delayed/failed alert distribution in \S~\ref{ssec:OTR1}).

% % % % % % % % % % % % %
\subsection{Number of Alerts per Visit}\label{ssec:transN}

{\bf It is a formal requirement that the DMS sustain the generation of an average of at least $10,000$ alerts per visit, and an instantaneous maximum of at least $40,000$ alerts per visit.}

The SRD states that the DMS {\it "should be capable of reporting such data for at least {\tt transN} candidate transients per field of view and visit,"} where the design, minimum, and stretch values for {\tt transN} are $10^4$, $10^3$, and $10^5$ respectively \citedsp{LPM-17}. The SRD's requirement flows down to the LSR, in which it is unclear whether {\tt transN} refers to an average or an instantaneous limit (LSR-REQ-0101, \citeds{LSE-29}). The OSS clarifies this with a formal requirement that the DMS {\it "shall be sized to accommodate an average value of at least {\tt nAlertVisitAvg} alerts generated per standard visit"}, where {\tt nAlertVisitAvg} is $10^4$ (OSS-REQ-0193 in \citeds{LSE-30}). Pending updates to the OSS and the DMSR will clarify that the DMS must support a long-term average number of alerts per night of {\tt nAlertNightAvg} $=10,000,000$ (i.e., $10,000$ alerts per visit for $1000$ visits per night), and instantaneous peaks of {\tt nAlertVisitMax}$=40,000$ alerts per visit.

The value of $10,000$ alerts per visit is a formal requirement on the DMS and not a scientific estimate of the intrinsic rate of transients and variables in the universe. However, estimates for the most common transients and variables can be derived from the Science Book \citep{2009arXiv0912.0201L} by making some significant assumptions, as follows:
\begin{itemize}
\item Variable Stars: LSST is predicted to observe a total of $\sim135$ million variable stars. Making the simple assumption that $20$/$80$\% of the stars are in extra/galactic fields, and that of the $\sim18000$ $\rm deg^2$ surveyed by LSST, $80$/$20$\% of the fields are extra/galactic, and that $10$\% of all variable stars are detectably variable at any given time, then a typical extra/galactic field would yield $\sim1800$/$28800$ alerts per visit. Averaged over all fields, and weighted by $80$/$20$\% of the fields being extra/galactic, this is $7200$ alerts per visit.
\item Supernovae: LSST is predicted to observe a total of 10 million supernovae in 10 years, or 1 million per year. Since SNe are typically only visible for a few months, there might be $\sim0.3$ million detectable at any given time. Over $15000$ $\rm deg^{2}$ of extragalactic survey area, that's $\sim20\ {\rm SNe\ deg^{-2}}$ or $\sim200$ alerts for SNe per visit.
\item Active Galactic Nuclei: LSST is predicted to observe millions of AGN. If $\sim10\%$ of them are detectably variable at any given time, then the estimate is $\sim0.1$ million alerts over $15000\ {\rm deg^2}$ would generate $\sim7\ {\rm alerts\ deg^{-2}}$ or $\sim70$ alerts per visit for AGN.
\item Moving Objects: The number of Solar System objects that LSST is predicted to observe is dominated by the 5.5 million main-belt asteroids. Assuming that they are spread evenly over the $\sim18000$ $\rm deg^2$ survey area (even though they're not, as they're found primarily along the ecliptic) leads to $\sim3000$ alerts per visit due to moving objects.
\end{itemize} 
Therefore, astrophysical estimates for the occurrence rates of alerts caused by the most common types of transients and variables yield $\sim5100$/$32000$ alerts per visit in extra/galactic fields, with an average of $\sim10500$ alerts per visit.


% % % % % % % % % % % % %
\subsection{Alert Packet Size}\label{ssec:packet_size}

{\bf The size of an individual alert packet is estimated to be $\lesssim82$ $\rm KB$.}

There are no formal requirements regarding the alert packet size; this is an estimate based on the planned content of the alerts as described in Section 3.5 of \citeds{LSE-163}. Simulated alert packets based on the Apache Avro format are at most $\sim82$/$126$ $\rm KB$, without/with the schema, respectively. This volume represents an alert packet for a variable star with a full $12$ month history of detections. \textcolor{red}{As additional examples, a new unassociated source with only a single detection would be $\sim?$ $\rm KB$, and a $\sim1$ month long transient followed by $\sim11$ months of forced photometry would be $\sim?$ $\rm KB$.} The application of gzip compression can further reduce the size of an alert to $\sim65$ $\rm KB$ (JIRA ticket DM-16280). Cutout stamps included in the alert will be at least $30\times30$ pixels and contain flux ($32$ bit/pix), variance ($32$ bit/pix), and mask ($16$ bit/pix) extensions for both the template and difference image, plus a header of metadata \citedsp{LSE-163}. The stamps alone will contribute $\gtrsim18$ $\rm KB$ to the total size of the uncompressed alert packet (i.e., $\sim20\%$).

{\bf "Lite" Packet Options --} Brokers which plan to do their own source association, compile source catalogs based on alerts, or not use the image stamps might prefer a stream of packets with appropriately reduced information. The LSST DM team currently expects that some options will be possible, and brokers may propose an option that works for them during the selection process \citedsp{LDM-612}. As previously mentioned, removing the image stamps would reduce packet size by $\gtrsim18$ $\rm KB$. Removing the historical records of past detections would reduce all alert packets to be equivalent in size to a new unassociated source. A few of these options might also be available to users of the LSST alert filtering service (\S~\ref{sec:LAFS}). 


% % % % % % % % % % % % %
\subsection{Alert Stream Data Rate}\label{ssec:data_rate}

{\bf The {\it time-averaged} data rate of the alert stream is estimated to be $\sim25$ $\rm MB/sec$, potentially with bursts of up to $640$ $\rm MB/sec$.}

There are no formal requirements regarding the alert stream data rate, these are estimates based on the expected size of an alert packet, the number of alerts per visit, and the alert distribution mechanism. The size of a single LSST alert will be $\sim82$ $\rm KB$ (including image stamps but not schema nor compression). Using an average of $\sim10000$ alerts released per $\sim30$ second image $+2$ second readout, this leads to a {\it time-averaged} alert stream data rate of  $\sim25$ $\rm MB\ s^{-1}$. As discussed in \S~\ref{ssec:transN}, the number of alerts per field will vary in extra/galactic fields from $\sim2000$ to $\lesssim40000$, which would produce {\it time-averaged} alert streams of $\sim5$ to $\lesssim100$ $\rm MB\ s^{-1}$. However, in order to release alerts within {\tt OTT1} $=60$ seconds of image readout (\S~\ref{ssec:OTT1}), the stream will not be continuous in time, but periodic, with potential bursts. For example, if all $10000$ alerts are issued within the last $5$ seconds of {\tt OTT1}, this would produce a data rate of $160$ $\rm MB\ s^{-1}$; in galactic fields with $\lesssim40000$ alerts this could be as high as $640$ $\rm MB\ s^{-1}$.


% % % % % % % % % % % % %
\subsection{Number of Selected Brokers}\label{ssec:num_brokers}

{\bf The DM team estimates that resources will allow for the delivery of the alert stream to $4$ to $7$ community brokers.}

There are no formal requirements on the number of brokers; this is an estimate based on the alert stream data rate and the planned alert distribution mechanism. As described in Section 2.2.3 of \citeds{LDM-612}, {\it "An allocation of $10$ $\rm Gbps$ is baselined for alert stream transfer from the [LSST Data Facility], with an estimated packet size of $82$ $\rm KB$ and up to $10,000$ alerts per visit. For illustration, based on these numbers up to $7$ brokers could receive the full stream if $5$ seconds is budgeted for outbound data transfer."} 


% % % % % % % % % % % % %
\subsection{Alert Database Volume}\label{ssec:adb_volume}

{\bf The estimated maximum upper limit for the full, 10-year alerts database is $\lesssim3$ $\rm PB$.}

There are no formal requirements on the alerts database volume; this is an estimate based on the alert packet contents and the number of alerts per night. As described in \S~\ref{ssec:transN}, the DMS system will support an average of $\sim10$ million alerts per night (which approximately matches the expected scientific yields). Assuming the upper estimate of $\sim82$ $\rm KB$ per alert (\S~\ref{ssec:packet_size}), that leads to a total of $\sim782$ $\rm GB$ per night. An extreme upper limit is $365$ nights per year for 10 years, which would amount to $\sim2.7$ $\rm PB$ {\it at the very most}. Therefore we quote an extreme upper limit on the alerts database as $\lesssim3$ $\rm PB$. Compression could drastically lower this, as could reformatting: every alert contains a $\sim12$ month historical record and links to the most recent DIAObject and DR Object catalogs. The set of alerts for the same transient/variable would contain a significant amount of redundant information which could be reformatted (i.e., removed from the individual alerts and compiled elsewhere in an alerts database). 


% % % % % % % % % % % % %
\subsection{Delayed/Failed Alert Distribution}\label{ssec:OTR1}

{\bf It is a formal requirement that $<1\%$ ($<0.1\%$) of all science visits experience delayed (failed) alert generation and distribution.}

The OSS specifies that {\it "no more than {\tt sciVisitAlertFailure} \% of science visits ... shall fail to be subjected to alert generation and distribution, integrated over all stages of data handling"}, where {\tt sciVisitAlertFailure} $=0.1\%$, and that {\it "no more than {\tt sciVisitAlertDelay} \% of science visits ... shall have their alert generation and distribution completed later than [{\tt OTT1}]"}, where {\tt sciVisitAlertDelay} $=1\%$ (OSS-REQ-0112; \citeds{LSE-30}). \textcolor{red}{There is currently a change request in progress to clarify a few things about these requirements: (1) that a visit for which even $1$ alert is generated but never made available counts towards {\tt sciVisitAlertFailure}; (2) that visits for which $<98\%$ ({\tt OTR1}) of alerts are made available within {\tt OTT1} counts towards {\tt sciVisitAlertDelay}; and (3) to include similar requirements in the DMSR.} Assuming an estimated $10,000,000$ alerts per night (\S~\ref{ssec:transN}), brokers can rely on the DMS to not exceed an upper limit of $\lesssim 200,000$ alerts ($\lesssim 2\%$) made available with a latency $>${\tt OTT1}$=60$ seconds, and an upper limit of $\lesssim 10,000$ alerts (or $1$ visit) that fail to be made available.


% % % % % % % % % % % % %
\subsection{Alert Stream Completeness and Purity}\label{ssec:comp_pure}

{\bf It is a formal requirement that DM derive and supply threshold values for a spuriousness parameter which can be used to filter alerts into a subsample with a given completeness and purity.}

The SRD makes no statements about alert stream purity or completeness, but does state that the {\it "minimum signal-to-noise ratio in difference image for reporting detection of a transient object"} has a design specification of {\tt transSNR} $=5$ \citedsp{LPM-17}. The LSR contains essentially the same definition for {\tt transSNR}: {\it "the signal-to-noise ratio in single-visit difference images above which all optical transients are to be reported"} (LSR-REQ-0101; \citeds{LSE-29}). There is no minimum specification or stretch goal associated with {\tt transSNR}. However, as described in the DPDD, detections with {\tt transSNR} $>5$ but {\it "with high probability of being instrumental non-astrophysical artifacts may be excluded"} (Section 3.1, \citeds{LSE-163}), and a limited number of {\tt transSNR} $<5$ sources might be allowed to generate alerts (e.g., sources near a gravitational keyhole which could make an asteroid potentially hazardous; Section 3.2.1, \citeds{LSE-163}). 

Regarding the alert stream completeness and purity, the OSS requires that {\it "there shall exist a spuriousness threshold {\tt T}, for which the completeness and purity of selected difference sources are higher than {\tt transCompletenessMin} and {\tt transPurityMin}, respectively, at the SNR detection threshold {\tt transSampleSNR}. This requirement is to be interpreted as an average over the entire survey"} (OSS-REQ-0353; \citeds{LSE-30}). The values of these requirement parameters for transients are {\tt transSampleSNR} $=6$, {\tt transCompletenessMin} $=90\%$, and {\tt transPurityMin} $=95\%$. (For moving objects there is a separate specification for a threshold pertaining to {\tt transSampleSNR} $=5$, {\tt mopsCompletenessMin} $=99\%$, and {\tt mopsPurityMin} $=50\%$; OSS-REQ-0354, \citeds{LSE-30}). This spuriousness threshold {\tt T} will allow users to filter their stream to a fiducial completeness and purity, thereby reducing the fraction of false positives (sources detected that are not astrophysical in origin). Brokers may request a pre-filtered stream that includes a restriction on spuriousness.


% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\section{The LSST Alert Filtering Service} \label{sec:LAFS}

{\bf It is a formal requirement that the LSST provide a simple alerts filtering service for users (individuals with LSST data rights and access to the Science Platform), which is hereafter referred to as the LSST alert filtering service (LAFS).}

The SRD specifies that {\it "users will have an option of a query-like pre-filtering of the [alert] data stream in order to select likely candidates for specific transient type"} and that {\it "several pre-defined filters optimized for traditionally popular transients, such as supernovae and microlensed sources, will also be available"} \citedsp{LPM-17}. This flows down directly to the DMSR, which has a formal requirement that {\it "a basic, limited capacity, alert filtering service shall be provided that can be given user defined filters to reduce the alert stream to manageable levels"}, and that this service include {\it "a predefined set of simple filters"} (DMS-REQ-0342, -0348; \citeds{LSE-61}). 


% % % % % % % % % % % % %
\subsection{Number of Simultaneous LAFS Users}\label{ssec:LAFS_users}

{\bf It is a formal requirement that the LAFS be able to support a minimum of $100$ simultaneous users.}

The DMSR specifies that the LSST {\it "alert filtering service shall support {\tt numBrokerUsers} simultaneous users"}, where {\tt numBrokerUsers} $=100$ (DMS-REQ-0343; \citeds{LSE-61}).


% % % % % % % % % % % % %
\subsection{Number of Alerts per Visit Returned by LAFS}\label{ssec:LAFS_returns}

{\bf It is a formal requirement that the LAFS be able to return $20$ alerts per visit per user.}

The DMSR specifies that within the LSST alert filtering service {\it "each user [shall be] allocated a bandwidth capable of receiving the equivalent of {\tt numBrokerAlerts} alerts per visit"}, where {\tt numBrokerAlerts} $=20$ (DMS-REQ-0343; \citeds{LSE-61}). However, note that in a footnote of \citeds{LDM-612}, it says that the {\it "requirement on the number of simultaneously connected users and number of passed alerts is largely driven by outbound bandwidth limitations from the DAC at NCSA. We are investigating approaches that would support larger numbers of active filters"} (page 12; \citeds{LDM-612}).


% % % % % % % % % % % % %
\subsection{Alerts Database}\label{ssec:LAFS_adb}

{\bf It is a formal requirement that all alerts be stored in a database and available for query.}

The OSS states that {\it "All published transient alerts ... shall be available for query"}, and this applies to users with data rights and access to the LSST science platform (OSS-REQ-0185; \citeds{LSE-30}). Like all other Prompt data products, the alerts database will be updated within {\tt L1PublicT} $=24$ hours (LSR-REQ-0104, \citeds{LSE-29}). The alerts database is not a part of LAFS, but is included in this section to emphasize that science users who do not need a latency of $<24h$ should be querying the alerts database {\it instead of} creating LAFS filters.


% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\clearpage

% Include all the relevant bib files.
% https://lsst-texmf.lsst.io/lsstdoc.html#bibliographies
\bibliography{local,lsst,lsst-dm,refs_ads,refs,books}

\end{document}
